{% extends "base.html" %}
{% from 'tasks/_task_item.html' import render_dashboard_task with context %}

{% block content %}
<h1>Dashboard</h1>
<p>Welcome back to the forests of Pandora, {{ current_user.username }}!</p>

<div class="row mt-4">
    <div class="col-md-7">
        <div class="card card-pandora">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>My Projects</span>
                <a href="{{ url_for('projects.new_project') }}" class="btn btn-sm btn-pandora-secondary">New Project</a>
            </div>
            <div class="card-body">
                {% if projects %}
                    <ul class="list-group list-group-flush">
                        {% for project in projects[:5] %} {# Show first 5 projects #}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <a href="{{ url_for('projects.project_detail', project_id=project._id) }}">{{ project.name }}</a>
                                <span class="badge rounded-pill status-{{ project.status|lower|replace(' ', '') }}">{{ project.status }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                    {% if projects|length > 5 %}
                        <a href="{{ url_for('projects.project_list') }}" class="btn btn-sm btn-pandora-secondary mt-3">View All Projects</a>
                    {% endif %}
                {% else %}
                    <p>No active projects found. Time to start exploring!</p>
                    <a href="{{ url_for('projects.new_project') }}" class="btn btn-pandora mt-3">Create First Project</a>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-5">
         <div class="card card-pandora">
            <div class="card-header">Upcoming Tasks</div>
            <div class="card-body">
                {% if tasks %}
                     <ul class="list-group list-group-flush">
                        {% for task in tasks %}
                            {{ render_dashboard_task(task) }}
                        {% endfor %}
                     </ul>
                {% else %}
                     <p>No upcoming tasks. Enjoy the tranquility (for now)!</p>
                {% endif %}
                 {# Add link to view all tasks page if created #}
                 {# <a href="#" class="btn btn-sm btn-pandora-secondary mt-3">View My Tasks</a> #}
            </div>
        </div>
        {# Add more dashboard widgets: Activity Feed, Stats, etc. #}
    </div>
</div>
{% endblock %}