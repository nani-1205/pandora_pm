{% extends "base.html" %}
{# Import the macro from _task_item.html #}
{% from 'tasks/_task_item.html' import render_task with context %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap"> {# Added flex-wrap #}
    <div>
         <h1 class="mb-0 me-3">{{ project.name }}</h1> {# Added margin #}
         <span class="badge rounded-pill status-{{ project.status|lower|replace(' ', '') }} ms-2">{{ project.status }}</span>
    </div>
    {# Action buttons grouped together #}
    <div class="project-actions mt-2 mt-md-0 text-nowrap"> {# Added text-nowrap and margin for smaller screens #}
        <a href="{{ url_for('projects.edit_project', project_id=project._id) }}" class="btn btn-sm btn-pandora-secondary me-2">Edit Project</a>
         {# Delete form with confirmation #}
         <form method="POST" action="{{ url_for('projects.delete_project_route', project_id=project._id) }}" class="d-inline delete-confirm" data-confirm-message="Are you sure you want to delete project '{{ project.name }}' and all its tasks?">
             <button type="submit" class="btn btn-sm btn-pandora-danger">Delete Project</button>
         </form>
    </div>
</div>

 <p class="text-muted">
    Created: {{ project.created_at.strftime('%Y-%m-%d %H:%M') if project.created_at else 'N/A' }}
    {% if project.due_date %} | Due: {{ project.due_date.strftime('%Y-%m-%d') }} {% endif %}
    {% if project.updated_at and project.updated_at != project.created_at %} | Last Updated: {{ project.updated_at.strftime('%Y-%m-%d %H:%M') }} {% endif %}
</p>

{% if project.description %}
    <div class="project-description">
        <h4>Description</h4>
        {# Use pre-wrap to preserve line breaks #}
        <p style="white-space: pre-wrap;">{{ project.description }}</p>
    </div>
{% endif %}

<hr class="my-4" style="border-color: #3a506b;">

<div class="d-flex justify-content-between align-items-center mb-3">
     <h3>Tasks</h3>
     <a href="{{ url_for('projects.new_task', project_id=project._id) }}" class="btn btn-pandora-secondary">Add New Task</a>
</div>

<div class="tasks-list">
    {% if tasks %}
        {% for task in tasks %}
             {# Pass users_dict when calling the macro #}
            {{ render_task(project._id, task, users_dict) }}
        {% endfor %}
    {% else %}
        <div class="card card-pandora" >
            <div class="card-body text-center">
                 <p class="mb-0">No tasks have been added to this project yet.</p>
            </div>
        </div>
    {% endif %}
</div>

{% endblock %}