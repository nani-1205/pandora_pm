{% extends "base.html" %}
{% from 'tasks/_task_item.html' import render_task with context %} {# Import the macro #}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
         <h1 class="mb-0">{{ project.name }}</h1>
          <span class="badge rounded-pill status-{{ project.status|lower|replace(' ', '') }} ms-2">{{ project.status }}</span>
    </div>
    <div>
        <a href="{{ url_for('projects.edit_project', project_id=project._id) }}" class="btn btn-sm btn-pandora-secondary me-2">Edit Project</a>
         {# Add delete form with confirmation #}
         <form method="POST" action="{{ url_for('projects.delete_project_route', project_id=project._id) }}" class="d-inline delete-confirm" data-confirm-message="Are you sure you want to delete project '{{ project.name }}' and all its tasks?">
             <button type="submit" class="btn btn-sm btn-pandora-danger">Delete Project</button>
         </form>
    </div>
</div>

 <p class="text-muted">
    Created: {{ project.created_at.strftime('%Y-%m-%d %H:%M') }}
    {% if project.due_date %} | Due: {{ project.due_date.strftime('%Y-%m-%d') }} {% endif %}
    {% if project.updated_at %} | Last Updated: {{ project.updated_at.strftime('%Y-%m-%d %H:%M') }} {% endif %}
</p>

{% if project.description %}
    <div class="project-description">
        <h4>Description</h4>
        <p>{{ project.description | replace('\n', '<br>') | safe }}</p>
    </div>
{% endif %}

<hr class="my-4">

<div class="d-flex justify-content-between align-items-center mb-3">
     <h3>Tasks</h3>
     <a href="{{ url_for('projects.new_task', project_id=project._id) }}" class="btn btn-pandora-secondary">Add New Task</a>
</div>

<div class="tasks-list">
    {% if tasks %}
        {% for task in tasks %}
            {{ render_task(project._id, task) }} {# Call the macro #}
        {% endfor %}
    {% else %}
        <p>No tasks have been added to this project yet.</p>
    {% endif %}
</div>

{% endblock %}