<!-- app/templates/task_detail.html -->
{% extends "base.html" %}

{% block content %}
<div class="task-detail-box panel-box"> {# Optional class #}
    <h1>Task: {{ task.title }}</h1>
    <p><strong>Project:</strong> <a href="{{ url_for('main.project_detail', project_id=task.project.id) }}">{{ task.project.name }}</a></p>
    {# --- Display Work Package if it exists --- #}
    {% if task.work_package %}
    <p><strong>Work Package:</strong> {{ task.work_package.name }}</p> {# Add link later if WP gets detail page #}
    {% endif %}
    {# --- End Work Package Display --- #}
    <p><strong>Description:</strong></p>
    <div style="background-color: rgba(0,0,0,0.1); padding: 10px; border-radius: 4px; margin-bottom: 15px;">
        {{ task.description|safe or 'No description provided.'}} {# Use safe filter if description might contain HTML #}
    </div>
    <p><strong>Assigned To:</strong> {{ task.assigned_to.username }}</p>
    <p><strong>Current Status:</strong> <span class="status-{{ task.status|lower|replace(' ', '-') }}">{{ task.status }}</span></p>
    <p><strong>Created By:</strong> {{ task.created_by.username }} on {{ task.created_at.strftime('%Y-%m-%d') }}</p>
    {% if task.due_date %}
    <p><strong>Due Date:</strong> {{ task.due_date.strftime('%Y-%m-%d') }}</p>
    {% endif %}

    <hr>

    {% if can_update %}
    <div class="form-container task-update-form" style="max-width: 400px; margin: 20px 0;"> {# Inline style example #}
        <h3>Update Task Status</h3>
        <form method="POST" action="{{ url_for('main.task_detail', task_id=task.id) }}">
            {{ form.hidden_tag() }}
            <div class="form-group">
                {{ form.status.label }}
                {{ form.status(class="form-control") }}
                 {% if form.status.errors %}<div class="errors">{% for error in form.status.errors %}<small>{{ error }}</small>{% endfor %}</div>{% endif %}
            </div>
             <div class="form-group">
                {{ form.submit(class="btn btn-primary") }}
            </div>
        </form>
    </div>
    {% else %}
        <p>You do not have permission to update this task's status.</p>
    {% endif %}
</div>
<p style="margin-top: 20px;"><a href="{{ url_for('main.project_detail', project_id=task.project.id) }}">Back to Project</a></p>

{% endblock %}