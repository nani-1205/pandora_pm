{% extends "base.html" %}
{# Import macros if needed, e.g., for form fields if using WTForms #}
{# {% import "_macros.html" as macros %} #}

{% block content %}
<h2>Edit User: {{ user_to_edit.username if user_to_edit else 'N/A' }}</h2>
<hr class="mb-4">

{% if user_to_edit %}
    {# Assumes a POST route: url_for('admin.edit_user', user_id=user_to_edit._id) #}
    <form method="POST" action="{{ url_for('admin.edit_user', user_id=user_to_edit._id) }}">
        {# Add CSRF token if using Flask-WTF: {{ form.hidden_tag() }} #}

        <div class="row">
            <div class="col-md-6">
                {# Example using basic HTML inputs #}
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="username" name="username" required value="{{ request.form.username or user_to_edit.username }}">
                    {# Display validation errors if any #}
                </div>
                 <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" required value="{{ request.form.email or user_to_edit.email }}">
                     {# Display validation errors if any #}
                </div>
            </div>
            <div class="col-md-6">
                 <div class="mb-3">
                    <label for="role" class="form-label">Role</label>
                    <select class="form-select" id="role" name="role" {% if current_user.id == user_to_edit._id|string %}disabled title="Cannot change your own role here"{% endif %}>
                        {# Pre-select the current role #}
                        {% set current_role = request.form.role or user_to_edit.role %}
                        <option value="user" {% if current_role == 'user' %}selected{% endif %}>User</option>
                        <option value="admin" {% if current_role == 'admin' %}selected{% endif %}>Admin</option>
                    </select>
                     {% if current_user.id == user_to_edit._id|string %}
                     <small class="form-text text-warning">Admins cannot change their own role via this form.</small>
                     {% endif %}
                </div>
                {# Add fields for First Name, Last Name, etc. if you add them to the model #}

                 {# Password change is usually handled separately for security #}
                 <div class="mt-4 pt-3 border-top border-secondary">
                     <p class="text-muted">Password changes should typically be handled via a separate "Change Password" or "Reset Password" feature.</p>
                 </div>

            </div>
        </div>


        <div class="mt-4">
            <button type="submit" class="btn btn-pandora">Save Changes</button>
            <a href="{{ url_for('admin.user_list') }}" class="btn btn-pandora-secondary">Cancel</a>
        </div>
    </form>
{% else %}
    <div class="alert alert-danger">User not found.</div>
    <a href="{{ url_for('admin.user_list') }}" class="btn btn-pandora-secondary">Back to User List</a>
{% endif %}

{% endblock %}