{% extends "base.html" %}

{% block content %}
<h1 class="mb-4">Manage Users</h1>

{% if users %}
<div class="table-responsive">
    <table class="table table-pandora table-hover">
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th>Registered On</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td><span class="badge role-badge role-{{ user.role }}">{{ user.role|capitalize }}</span></td>
                <td>{{ user.created_at.strftime('%Y-%m-%d %H:%M') if user.created_at else 'N/A' }} UTC</td>
                <td>
                   <form action="{{ url_for('admin.set_user_role', user_id=user._id) }}" method="POST" class="d-inline-block">
                       <select name="role" class="form-select form-select-sm d-inline-block w-auto me-2">
                           <option value="user" {{ 'selected' if user.role == 'user' else '' }}>User</option>
                           <option value="admin" {{ 'selected' if user.role == 'admin' else '' }}>Admin</option>
                       </select>
                       <button type="submit" class="btn btn-sm btn-pandora-secondary"
                               {% if current_user.id == user._id %}
                               {# Basic check to prevent self-demotion - more robust check in route #}
                               {# onclick="return confirm('Are you sure you want to change your own role?');" #}
                               {% endif %}
                               >Set Role</button>
                   </form>
                   {# Add Delete button with caution and confirmation #}
                   <!--
                   <form action="{{ url_for('admin.delete_user', user_id=user._id) }}" method="POST" class="d-inline-block ms-2" onsubmit="return confirm('Are you absolutely sure you want to delete user {{ user.username }}? This cannot be undone.');">
                        <button type="submit" class="btn btn-sm btn-danger" {% if current_user.id == user._id %}disabled title="Cannot delete yourself"{% endif %}>Delete</button>
                   </form>
                   -->
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p>No users found (except maybe you!).</p>
{% endif %}

{% endblock %}